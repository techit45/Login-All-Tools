<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡πà‡∏≤‡∏¢ - Payment Slip Processing System</title>
    <style>
        /* ==================== CSS Styles ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            margin-top: 30px;
        }

        .content-area {
            min-width: 0; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô grid overflow */
        }

        .right-sidebar {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 0;
            overflow: hidden;
            position: sticky;
            top: 20px;
            height: fit-content;
            max-height: calc(100vh - 40px);
        }

        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo-container {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .logo-container img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }

        .logo-placeholder {
            font-size: 32px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: bold;
        }

        .header h1 {
            background: linear-gradient(45deg, #ffffff, #e3f2fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.8em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
        }

        .company-tagline {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1em;
            margin-top: 5px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .header p {
            color: rgba(255,255,255,0.9);
            font-size: 1.2em;
        }

        /* Tab System */
        .tab-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tab-nav {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
        }

        .tab-btn {
            flex: 1;
            padding: 20px;
            border: none;
            background: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-btn:hover {
            background: #f8f9ff;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Styles */
        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.5em;
            margin-bottom: 20px;
            font-weight: 600;
        }

        /* Entry Items */
        .entries-container {
            margin-bottom: 30px;
        }

        .entry-item {
            background: #f8f9ff;
            border: 2px solid #e6e8ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
        }

        .entry-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e6e8ff;
        }

        .entry-header h4 {
            color: #667eea;
            font-size: 1.3em;
            font-weight: 600;
        }

        .btn-remove-entry {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .btn-remove-entry:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .form-group textarea[readonly] {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        
        /* Date Range Styling */
        .date-range-container {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 5px;
        }
        
        .date-range-container input[type="number"],
        .date-range-container select {
            padding: 8px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .date-range-container input[type="number"]:focus,
        .date-range-container select:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 2px rgba(42,82,152,0.1);
        }
        
        .date-range-separator {
            font-weight: bold;
            color: #2a5298;
            font-size: 1.1em;
        }

        /* File Upload */
        .file-upload {
            position: relative;
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
        }

        .file-upload:hover {
            border-color: #2a5298;
            background: #f0f7ff;
        }

        .file-upload.dragover {
            border-color: #2a5298;
            background: #e3f2fd;
            transform: scale(1.02);
        }

        .file-upload input[type="file"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-upload-content {
            pointer-events: none;
        }

        .file-upload-icon {
            font-size: 3em;
            margin-bottom: 10px;
            color: #ccc;
        }

        .file-upload.dragover .file-upload-icon {
            color: #667eea;
        }

        .file-selected {
            background: #e8f5e8;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .file-info {
            margin-top: 10px;
            padding: 10px;
            background: rgba(76,175,80,0.1);
            border-radius: 5px;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .file-item {
            margin: 5px 0;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 5px;
            border-left: 3px solid #4caf50;
        }
        
        .files-summary {
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(76,175,80,0.2);
            border-radius: 5px;
            font-weight: bold;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(30,60,114,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-add {
            background: linear-gradient(45deg, #0d47a1, #1565c0);
        }

        .btn-add:hover {
            box-shadow: 0 10px 20px rgba(13,71,161,0.3);
        }

        .btn-submit {
            background: linear-gradient(45deg, #0d47a1, #1565c0);
            font-size: 1.2em;
            padding: 15px 30px;
        }

        .btn-submit:hover {
            box-shadow: 0 10px 20px rgba(13,71,161,0.3);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* Name Management */
        .name-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .name-item {
            background: #f8f9ff;
            border: 2px solid #e6e8ff;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .name-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .name-item h4 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .name-item p {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .name-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.8em;
            border-radius: 5px;
        }

        .btn-edit {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }

        .btn-delete {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h3 {
            color: #667eea;
            font-size: 1.4em;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .btn-close:hover {
            background: #f0f0f0;
            color: #333;
        }

        /* Loading and Messages */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-message {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            animation: slideInDown 0.5s ease;
        }

        .result-message.show {
            display: block;
        }

        .result-message.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result-message.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        @keyframes slideInDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            background: #f0f0f0;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .progress-container.show {
            display: block;
        }

        .progress-bar {
            height: 8px;
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            border-radius: 10px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .file-preview-item {
                width: 250px;
                height: 250px;
            }
            
            .file-preview-pdf-icon {
                font-size: 60px;
            }
            
            .file-preview-pdf {
                font-size: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .tab-content {
                padding: 20px;
            }

            .entry-item {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .name-list {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .entry-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .btn-remove-entry {
                align-self: flex-end;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.6em;
            }

            .header p {
                font-size: 1em;
            }

            .tab-btn {
                padding: 15px 10px;
                font-size: 1em;
            }

            .tab-content {
                padding: 15px;
            }

            .entry-item {
                padding: 15px;
            }
            
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î preview ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            .file-preview-item {
                width: 200px;
                height: 200px;
            }
            
            .file-preview-pdf-icon {
                font-size: 48px;
            }
            
            .file-preview-pdf {
                font-size: 16px;
            }
            
            .file-preview-overlay {
                font-size: 14px;
                padding: 12px 8px 8px;
            }
        }

        /* Image Preview Styles */
        .file-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
        }

        .file-preview-item {
            position: relative;
            width: 300px;
            height: 300px;
            border: 4px solid #e9ecef;
            border-radius: 20px;
            overflow: hidden;
            background: white;
            box-shadow: 0 6px 24px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-preview-item:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 48px rgba(0,0,0,0.25);
            border-color: #2a5298;
        }

        .file-preview-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .file-preview-item:hover .file-preview-image {
            transform: scale(1.05);
        }

        .file-preview-pdf {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            text-align: center;
            font-size: 24px;
            font-weight: 600;
        }

        .file-preview-pdf-icon {
            font-size: 72px;
            margin-bottom: 15px;
        }

        .file-preview-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 16px 12px 12px;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            word-break: break-word;
            line-height: 1.3;
        }

        /* Image Modal/Lightbox */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        .image-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            margin: auto;
            animation: zoomIn 0.3s ease;
        }

        .image-modal-image {
            max-width: 100%;
            max-height: 100%;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .image-modal-pdf {
            width: 90vw;
            height: 90vh;
            border-radius: 10px;
            border: none;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .image-modal-close {
            position: absolute;
            top: -40px;
            right: -40px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-modal-close:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .image-modal-info {
            position: absolute;
            bottom: -50px;
            left: 0;
            right: 0;
            color: white;
            text-align: center;
            font-size: 14px;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
        }

        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* File Info Enhancements */
        .file-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .file-info .files-summary {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .file-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 8px 12px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .file-item:hover {
            border-color: #2a5298;
            box-shadow: 0 2px 4px rgba(42,82,152,0.1);
        }

        /* Sidebar Styles */
        .sidebar-header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .sidebar-header h3 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
            font-weight: 600;
        }

        .sidebar-header p {
            margin: 0;
            font-size: 0.9em;
            opacity: 0.9;
        }

        .sidebar-content {
            padding: 20px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .submitted-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex-grow: 1;
            margin-bottom: 15px;
        }

        .submitted-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #28a745;
            transition: all 0.3s ease;
        }

        .submitted-item:hover {
            background: #e9ecef;
            transform: translateX(2px);
        }

        .submitted-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9em;
            flex-shrink: 0;
        }

        .submitted-info {
            flex: 1;
            min-width: 0;
        }

        .submitted-info h5 {
            margin: 0 0 4px 0;
            font-size: 0.9em;
            font-weight: 600;
            color: #1e3c72;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .submitted-info p {
            margin: 0;
            font-size: 0.75em;
            color: #6c757d;
        }

        .submitted-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
            flex-shrink: 0;
        }

        .sidebar-stats {
            background: linear-gradient(135deg, #e3f2fd, #f0f7ff);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .sidebar-controls {
            margin-bottom: 20px;
            text-align: center;
        }

        .btn-reset {
            background: linear-gradient(45deg, #dc3545, #c82333) !important;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-reset:hover {
            background: linear-gradient(45deg, #c82333, #bd2130) !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .stats-number {
            font-size: 2em;
            font-weight: 800;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .stats-label {
            font-size: 0.9em;
            color: #6c757d;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-state .icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .empty-state h4 {
            margin: 0 0 8px 0;
            font-size: 1em;
            color: #495057;
        }

        .empty-state p {
            margin: 0;
            font-size: 0.8em;
        }

        /* Google Drive Link Styles */
        .drive-link-section {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid #e9ecef;
        }

        .drive-link-header {
            margin-bottom: 12px;
        }

        .drive-link-header h4 {
            margin: 0;
            font-size: 0.9em;
            color: #1e3c72;
            font-weight: 600;
        }

        .drive-link-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border: 1px solid #e9ecef;
            border-radius: 10px;
            text-decoration: none;
            color: inherit;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drive-link-btn:hover {
            background: linear-gradient(135deg, #e3f2fd, #f0f7ff);
            border-color: #2a5298;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(42, 82, 152, 0.15);
            text-decoration: none;
            color: inherit;
        }

        .drive-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }

        .drive-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .drive-title {
            font-weight: 600;
            font-size: 0.9em;
            color: #1e3c72;
        }

        .drive-subtitle {
            font-size: 0.75em;
            color: #6c757d;
        }

        .drive-arrow {
            font-size: 1.2em;
            color: #2a5298;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .drive-link-btn:hover .drive-arrow {
            transform: translateX(3px);
        }

        /* Clickable submitted items */
        .submitted-item.clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submitted-item.clickable:hover {
            background: #e3f2fd;
            transform: translateX(3px);
            border-left-color: #1e3c72;
        }

        /* Detail Modal Styles */
        .detail-modal-content {
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .detail-modal-body {
            padding: 0;
        }

        .submission-detail-header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 20px;
            margin: -30px -30px 20px -30px;
            border-radius: 15px 15px 0 0;
        }

        .submission-detail-header h3 {
            margin: 0 0 8px 0;
            font-size: 1.3em;
        }

        .submission-detail-header h4 {
            margin: 0;
            font-size: 1.1em;
            opacity: 0.9;
        }

        .submission-basic-info,
        .submission-ocr-info,
        .submission-entries-info {
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #2a5298;
        }

        .submission-ocr-info {
            border-left-color: #28a745;
        }

        .submission-entries-info {
            border-left-color: #ffc107;
        }

        .submission-basic-info h5,
        .submission-ocr-info h5,
        .submission-entries-info h5 {
            margin: 0 0 15px 0;
            color: #1e3c72;
            font-size: 1.1em;
            font-weight: 600;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .detail-item strong {
            color: #495057;
            font-weight: 600;
            min-width: 140px;
            flex-shrink: 0;
        }

        .detail-item span {
            text-align: right;
            color: #1e3c72;
            font-weight: 500;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .entry-detail {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }

        .entry-detail h6 {
            margin: 0 0 12px 0;
            color: #1e3c72;
            font-size: 1em;
            font-weight: 600;
            padding-bottom: 8px;
            border-bottom: 2px solid #e3f2fd;
        }

        .payment-types-list {
            text-align: right;
        }

        .payment-type-item {
            margin-bottom: 8px;
            padding: 6px 12px;
            background: #e3f2fd;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .payment-type-item:last-child {
            margin-bottom: 0;
        }

        .payment-type-item small {
            color: #6c757d;
            font-style: italic;
        }

        /* OCR Multiple Files Styles */
        .ocr-file-result {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            border-left: 4px solid #28a745;
        }

        .ocr-file-result h6 {
            margin: 0 0 12px 0;
            color: #28a745;
            font-size: 0.95em;
            font-weight: 600;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }

        .ocr-file-result:last-child {
            margin-bottom: 0;
        }

        /* Responsive Detail Modal */
        @media (max-width: 768px) {
            .detail-modal-content {
                max-width: 95%;
                margin: 20px auto;
            }

            .detail-item {
                flex-direction: column;
                gap: 4px;
            }

            .detail-item strong {
                min-width: auto;
            }

            .detail-item span {
                text-align: left;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Responsive Sidebar */
        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr 250px;
                gap: 20px;
            }
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .right-sidebar {
                position: relative;
                top: 0;
                max-height: none;
                order: -1;
            }
        }

        /* OCR Result Styles */
        .ocr-container {
            margin: 15px 0;
        }

        .ocr-result {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #28a745;
            animation: slideInDown 0.5s ease;
        }

        .ocr-result.success {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
        }

        .ocr-result.error {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #ffeaea, #fff0f0);
        }

        .ocr-result h4 {
            color: #1e3c72;
            margin: 0 0 10px 0;
            font-size: 1.1em;
            font-weight: 600;
        }

        .ocr-result .recipient-info h4 {
            color: #28a745;
            font-size: 1.2em;
            margin: 8px 0;
            font-weight: 700;
        }

        .ocr-result p {
            margin: 5px 0;
            color: #6c757d;
            font-size: 0.9em;
        }

        .ocr-result small {
            color: #6c757d;
            font-size: 0.8em;
        }

        .ocr-result.error h4 {
            color: #dc3545;
        }

        /* Additional Utility Classes */
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .hidden { display: none !important; }
        .visible { display: block !important; }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="container">
        <div class="header">
            <div class="header-logo">
                <div class="logo-container">
                    <!-- Logo image slot - ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç src ‡πÑ‡∏î‡πâ -->
                    <img src="Logo.png" alt="Login Learning Logo" style="display: none;" id="companyLogo">
                    <div class="logo-placeholder" id="logoPlaceholder">LL</div>
                </div>
                <div>
                    <h1>Login Learning</h1>
                    <div class="company-tagline">Payment Management System</div>
                </div>
            </div>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</p>
        </div>

        <div class="main-layout">
            <!-- Main Content Area -->
            <div class="content-area">
                <!-- Main Tab Container -->
                <div class="tab-container">
            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchTab('upload-tab', this)">
                    üìÑ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ
                </button>
                <button class="tab-btn" onclick="switchTab('names-tab', this)">
                    üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
                </button>
            </div>

            <!-- Tab 1: Upload Slips -->
            <div id="upload-tab" class="tab-content active">
                <div class="form-section">
                    <h2 class="section-title">üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</h2>
                    
                    <!-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
                    <div class="form-group">
                        <label for="userType">üë§ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô *</label>
                        <select id="userType" required>
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô --</option>
                            <option value="board_member">üèõÔ∏è ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
                            <option value="employee" selected>üë• ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                        </select>
                    </div>
                    
                    <form id="paymentForm">
                        <div id="entriesContainer" class="entries-container">
                            <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô JavaScript -->
                        </div>

                        <div class="button-group">
                            <button type="button" class="btn btn-add" onclick="addEntry()">
                                üìÇ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
                            </button>
                            <button type="submit" class="btn btn-submit">
                                üöÄ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                        </div>
                    </form>

                    <!-- Loading ‡πÅ‡∏•‡∏∞ Progress -->
                    <div id="loadingSection" class="loading">
                        <div class="spinner"></div>
                        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                        <div id="progressContainer" class="progress-container">
                            <div id="progressBar" class="progress-bar"></div>
                        </div>
                    </div>

                    <!-- Result Messages -->
                    <div id="resultMessage" class="result-message"></div>
                </div>
            </div>

            <!-- Tab 2: Name Management -->
            <div id="names-tab" class="tab-content">
                <div class="form-section">
                    <h2 class="section-title">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h2>
                    
                    <div class="button-group mb-20">
                        <button class="btn btn-add" onclick="openAddModal()">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>

                    <div id="namesList" class="name-list">
                        <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô JavaScript -->
                    </div>
                </div>
            </div>
        </div>
            </div>
            
            <!-- Right Sidebar -->
            <div class="right-sidebar">
                <div class="sidebar-header">
                    <h3>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ</h3>
                    <p>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</p>
                </div>
                <div class="sidebar-content">
                    <div class="sidebar-stats">
                        <div class="stats-number" id="submittedCount">0</div>
                        <div class="stats-label">‡∏Ñ‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</div>
                    </div>
                    
                    <!-- Reset Button -->
                    <div class="sidebar-controls">
                        <button class="btn btn-reset" onclick="resetSubmittedUsers()">
                            üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                    
                    <div class="submitted-list" id="submittedList">
                        <div class="empty-state">
                            <div class="icon">üìã</div>
                            <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ</h4>
                            <p>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                        </div>
                    </div>
                    
                    <!-- Google Drive Link Section -->
                    <div class="drive-link-section">
                        <div class="drive-link-header">
                            <h4>üìÅ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</h4>
                        </div>
                        <a href="https://drive.google.com/drive/u/0/folders/1S6ty6ic0vh8JC0c1CR5XH3KSf8vni46w" 
                           target="_blank" 
                           class="drive-link-btn">
                            <div class="drive-icon">üíæ</div>
                            <div class="drive-text">
                                <span class="drive-title">Google Drive</span>
                                <span class="drive-subtitle">‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡πà‡∏≤‡∏¢</span>
                            </div>
                            <div class="drive-arrow">‚Üí</div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ -->
    <div id="nameModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà</h3>
                <button class="btn-close" onclick="closeModal()">√ó</button>
            </div>
            
            <form id="nameForm">
                <div class="form-group">
                    <label for="nameInput">üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                    <input type="text" id="nameInput" required placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                </div>
                
                <div class="form-group">
                    <label for="positionInput">üíº ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <input type="text" id="positionInput" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô">
                </div>
                
                <div class="form-group">
                    <label for="departmentInput">üè¢ ‡πÅ‡∏ú‡∏ô‡∏Å</label>
                    <input type="text" id="departmentInput" placeholder="‡πÅ‡∏ú‡∏ô‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î">
                </div>
                
                <div class="form-group">
                    <label for="notesInput">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <textarea id="notesInput" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button type="button" class="btn" onclick="closeModal()" style="background: #6c757d;">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Image Modal for Preview -->
    <div id="imageModal" class="image-modal">
        <div class="image-modal-content">
            <button class="image-modal-close" onclick="closeImageModal()">√ó</button>
            <img id="modalImage" class="image-modal-image" style="display: none;">
            <iframe id="modalPdf" class="image-modal-pdf" style="display: none;"></iframe>
            <div id="modalInfo" class="image-modal-info"></div>
        </div>
    </div>

    <!-- Detail Modal for Submission Details -->
    <div id="detailModal" class="modal">
        <div class="modal-content detail-modal-content">
            <div class="modal-header">
                <h3 id="detailModalTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ</h3>
                <button class="btn-close" onclick="closeDetailModal()">√ó</button>
            </div>
            <div id="detailModalBody" class="detail-modal-body">
                <!-- Content will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <script>
        // ==================== JavaScript Functions ====================
        
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        let entryCount = 0;
        let editingIndex = -1;
        let submittedUsers = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß
        
        // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        let nameList = [
            {name: "‡∏ô‡∏≤‡∏¢‡∏ô‡∏û‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏û‡∏¥‡∏†‡∏±‡∏Å‡∏î‡∏µ", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏ê‡∏™‡∏∏‡∏î‡∏≤ ‡∏ó‡∏£‡∏á‡∏Ñ‡∏£‡∏∏‡∏ë", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏ ‡πÄ‡∏ó‡∏®‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏µ‡∏£‡∏ò‡∏¥‡∏î‡∏≤ ‡πÑ‡∏ä‡∏¢‡∏ä‡∏≤‡∏ï‡∏¥", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡∏ò‡∏ô‡∏ä‡∏≤‡∏ï ‡∏®‡∏£‡∏µ‡∏ô‡∏∏‡∏£‡∏±‡∏ï‡∏ô‡πå", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏û‡∏•‡∏≠‡∏¢‡πÄ‡∏û‡πá‡∏ä‡∏£", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏•‡∏¥‡∏ï‡∏≤ ‡∏õ‡∏£‡∏∞‡∏û‡∏±‡∏ó‡∏ò‡∏≤‡∏Ñ‡∏¥‡∏ì‡∏µ", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏ô‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå ‡∏™‡∏∏‡∏Ç‡∏õ‡∏•‡∏±‡πà‡∏á", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡∏ò‡∏≤‡∏° ‡∏û‡∏á‡∏©‡πå‡πÄ‡∏à‡∏µ‡πà‡∏¢", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡∏Ç‡∏±‡∏ï‡∏ï‡∏¥‡∏¢‡∏∞ ‡πÑ‡∏Å‡∏¢‡∏∞‡∏£‡∏≤‡∏ä", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡πÄ‡∏ï‡∏ä‡∏¥‡∏©‡∏ê‡πå ‡∏¢‡∏≠‡∏î‡πÄ‡∏û‡πá‡∏ä‡∏£", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡∏ì‡∏ß‡∏±‡∏™‡∏ô‡πå ‡∏û‡∏£‡∏û‡∏±‡∏ä‡∏£‡∏ô‡∏¥‡∏ï‡∏¢‡πå", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡∏Å‡πâ‡∏≠‡∏á‡∏†‡∏û ‡∏Ç‡∏à‡∏£‡∏Ñ‡∏ï‡∏¥‡∏°‡∏≤", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡∏ò‡∏±‡∏ä‡∏ô‡∏ô‡∏ó‡πå ‡∏ò‡∏á‡∏®‡∏£‡∏µ", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏¢‡∏®‡∏±‡∏Å‡∏î‡∏∑‡πå‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÇ‡∏≠‡πà‡∏Ñ‡∏≥", position: "", department: "", notes: ""},
            {name: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏û‡∏±‡∏™‡∏™‡∏†‡∏£‡∏ì‡πå ‡∏ô‡∏Å‡πÅ‡∏Å‡πâ‡∏ß", position: "", department: "", notes: ""}
        ];

        // ==================== Logo Management ====================
        function initializeLogo() {
            const logoImg = document.getElementById('companyLogo');
            const logoPlaceholder = document.getElementById('logoPlaceholder');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ logo src ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            logoImg.addEventListener('load', function() {
                if (this.src && this.src !== window.location.href) {
                    this.style.display = 'block';
                    logoPlaceholder.style.display = 'none';
                }
            });
            
            logoImg.addEventListener('error', function() {
                this.style.display = 'none';
                logoPlaceholder.style.display = 'block';
            });
        }

        // ==================== LocalStorage Management ====================
        function loadNameListFromStorage() {
            try {
                const storedNameList = localStorage.getItem('paymentSlipNameList');
                if (storedNameList) {
                    const parsedList = JSON.parse(storedNameList);
                    // ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
                    nameList.forEach((defaultItem, index) => {
                        const existingItem = parsedList.find(item => item.name === defaultItem.name);
                        if (existingItem) {
                            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
                            nameList[index] = existingItem;
                        }
                    });
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏°‡∏µ‡πÉ‡∏ô localStorage ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    parsedList.forEach(storedItem => {
                        if (!nameList.find(item => item.name === storedItem.name)) {
                            nameList.push(storedItem);
                        }
                    });
                }
            } catch (error) {
                console.warn('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å LocalStorage:', error);
            }
        }
        
        function saveNameListToStorage() {
            try {
                localStorage.setItem('paymentSlipNameList', JSON.stringify(nameList));
                console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            } catch (error) {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ:', error);
                showResult('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
            }
        }

        // ==================== Sidebar Management ====================
        function updateSidebar() {
            const submittedCount = document.getElementById('submittedCount');
            const submittedList = document.getElementById('submittedList');
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
            submittedCount.textContent = submittedUsers.length;
            
            if (submittedUsers.length === 0) {
                // ‡πÅ‡∏™‡∏î‡∏á empty state
                submittedList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üìã</div>
                        <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ</h4>
                        <p>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                    </div>
                `;
            } else {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß
                submittedList.innerHTML = submittedUsers.map((user, index) => {
                    const initials = user.name.split(' ')
                        .map(n => n.charAt(0))
                        .join('')
                        .substring(0, 2);
                    
                    const timeAgo = getTimeAgo(user.submittedAt);
                    
                    return `
                        <div class="submitted-item clickable" onclick="showSubmissionDetail(${index})">
                            <div class="submitted-avatar">${initials}</div>
                            <div class="submitted-info">
                                <h5>${user.name}</h5>
                                <p>‡∏™‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${timeAgo}</p>
                            </div>
                            <div class="submitted-status"></div>
                        </div>
                    `;
                }).join('');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ
        function showSubmissionDetail(userIndex) {
            const user = submittedUsers[userIndex];
            if (!user) return;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
            let detailsHTML = `
                <div class="submission-detail-header">
                    <h3>üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ</h3>
                    <h4>üë§ ${user.name}</h4>
                </div>
                
                <div class="submission-basic-info">
                    <div class="detail-item">
                        <strong>üéØ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô:</strong>
                        <span>${user.recipientName || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á:</strong>
                        <span>${formatDateTime(user.submittedAt)}</span>
                    </div>
                    <div class="detail-item">
                        <strong>üë• ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</strong>
                        <span>${user.userType === 'employee' ? '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' : '‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó'}</span>
                    </div>
                </div>
            `;

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OCR ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if (user.submissionData && user.submissionData.ocrResult) {
                const ocr = user.submissionData.ocrResult;
                detailsHTML += `
                    <div class="submission-ocr-info">
                        <h5>üîç ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å OCR</h5>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <strong>üí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong>
                                <span>${ocr.amount || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</span>
                            </div>
                            <div class="detail-item">
                                <strong>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô:</strong>
                                <span>${ocr.date || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</span>
                            </div>
                            <div class="detail-item">
                                <strong>üè¶ ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</strong>
                                <span>${ocr.bank || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OCR ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)
            if (user.submissionData && user.submissionData.allOCRResults && user.submissionData.allOCRResults.length > 1) {
                detailsHTML += `
                    <div class="submission-ocr-info">
                        <h5>üîç ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å OCR (${user.submissionData.allOCRResults.length} ‡πÑ‡∏ü‡∏•‡πå)</h5>
                `;
                
                user.submissionData.allOCRResults.forEach((ocr, index) => {
                    detailsHTML += `
                        <div class="ocr-file-result">
                            <h6>üìÑ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ${ocr.fileIndex}: ${ocr.filename}</h6>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <strong>üë§ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô:</strong>
                                    <span>${ocr.recipientName || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</span>
                                </div>
                                <div class="detail-item">
                                    <strong>üí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong>
                                    <span>${ocr.amount || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</span>
                                </div>
                                <div class="detail-item">
                                    <strong>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô:</strong>
                                    <span>${ocr.date || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</span>
                                </div>
                                <div class="detail-item">
                                    <strong>üè¶ ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</strong>
                                    <span>${ocr.bank || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                detailsHTML += `</div>`;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if (user.submissionData && user.submissionData.entries) {
                detailsHTML += `
                    <div class="submission-entries-info">
                        <h5>üìÑ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á (${user.submissionData.entries.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h5>
                `;

                user.submissionData.entries.forEach((entry, index) => {
                    detailsHTML += `
                        <div class="entry-detail">
                            <h6>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${entry.entryNumber || index + 1}</h6>
                            <div class="detail-item">
                                <strong>üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong>
                                <span>${entry.details || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
                            </div>
                            <div class="detail-item">
                                <strong>üìé ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ü‡∏•‡πå:</strong>
                                <span>${entry.fileCount || 0} ‡πÑ‡∏ü‡∏•‡πå</span>
                            </div>
                        `;

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£)
                    if (entry.paymentType) {
                        detailsHTML += `
                            <div class="detail-item">
                                <strong>üíº ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢:</strong>
                                <span>${getPaymentTypeText(entry.paymentType)}</span>
                            </div>
                        `;
                    }

                    // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 2+)
                    if (entry.multiplePaymentTypes && entry.multiplePaymentTypes.length > 0) {
                        detailsHTML += `
                            <div class="detail-item">
                                <strong>üíº ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢:</strong>
                                <div class="payment-types-list">
                        `;
                        entry.multiplePaymentTypes.forEach(payment => {
                            detailsHTML += `
                                <div class="payment-type-item">
                                    ‚Ä¢ ${getPaymentTypeText(payment.type)}
                                    ${payment.details ? `<br>&nbsp;&nbsp;<small>${payment.details}</small>` : ''}
                                </div>
                            `;
                        });
                        detailsHTML += `
                                </div>
                            </div>
                        `;
                    }

                    detailsHTML += `</div>`;
                });

                detailsHTML += `</div>`;
            }

            // ‡πÅ‡∏™‡∏î‡∏á modal
            showDetailModal(detailsHTML);
        }

        function getPaymentTypeText(type) {
            const types = {
                'salary': '‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô',
                'bonus': '‡πÇ‡∏ö‡∏ô‡∏±‡∏™',
                'allowance': '‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á',
                'overtime': '‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤',
                'commission': '‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô',
                'facebook_ad': '‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ',
                'other': '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };
            return types[type] || type;
        }

        function formatDateTime(date) {
            const d = new Date(date);
            return d.toLocaleString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showDetailModal(content) {
            const modal = document.getElementById('detailModal');
            const modalBody = document.getElementById('detailModalBody');
            
            modalBody.innerHTML = content;
            modal.classList.add('show');
        }

        function closeDetailModal() {
            const modal = document.getElementById('detailModal');
            modal.classList.remove('show');
        }

        function addSubmittedUser(recipientName, submissionData = null) {
            // ‡∏´‡∏≤‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö recipientName ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
            let userName = recipientName;
            const foundEmployee = nameList.find(emp => 
                emp.name.includes(recipientName) || recipientName.includes(emp.name)
            );
            
            if (foundEmployee) {
                userName = foundEmployee.name;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            const alreadySubmitted = submittedUsers.some(user => user.name === userName);
            
            if (!alreadySubmitted) {
                const submissionRecord = {
                    name: userName,
                    recipientName: recipientName,
                    submittedAt: new Date(),
                    userType: document.getElementById('userType').value,
                    submissionData: submissionData // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                };
                
                submittedUsers.push(submissionRecord);
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
                saveSubmittedUsers();
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sidebar
                updateSidebar();
                
                console.log(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° ${userName} ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß`);
            }
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInMs = now - date;
            const diffInMinutes = Math.floor(diffInMs / (1000 * 60));
            const diffInHours = Math.floor(diffInMs / (1000 * 60 * 60));
            const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));
            
            if (diffInMinutes < 1) {
                return '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
            } else if (diffInMinutes < 60) {
                return `${diffInMinutes} ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
            } else if (diffInHours < 24) {
                return `${diffInHours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
            } else {
                return `${diffInDays} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
            }
        }

        // ==================== LocalStorage for Submitted Users ====================
        function saveSubmittedUsers() {
            try {
                localStorage.setItem('submittedUsers', JSON.stringify(submittedUsers));
                console.log('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            } catch (error) {
                console.error('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏î‡πâ:', error);
            }
        }

        function loadSubmittedUsers() {
            try {
                const stored = localStorage.getItem('submittedUsers');
                if (stored) {
                    submittedUsers = JSON.parse(stored).map(user => ({
                        ...user,
                        submittedAt: new Date(user.submittedAt) // ‡πÅ‡∏õ‡∏•‡∏á string ‡πÄ‡∏õ‡πá‡∏ô Date object
                    }));
                    console.log(`üìä ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ ${submittedUsers.length} ‡∏Ñ‡∏ô`);
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏î‡πâ:', error);
                submittedUsers = [];
            }
        }

        // ==================== OCR with Gemini Pro Vision ====================
        const GEMINI_API_KEY = 'AIzaSyDnijTt3my_sMB5y_IoVfOXxaV3gr0KOzY';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent';

        async function analyzePaymentSlipWithGemini(imageBase64, mimeType) {
            try {
                console.log('üîç ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏•‡∏¥‡∏õ‡∏î‡πâ‡∏ß‡∏¢ Gemini Pro Vision...');
                
                const requestBody = {
                    contents: [{
                        parts: [
                            {
                                text: "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏±‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ:\n1. ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô (‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô)\n2. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô\n3. ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô\n4. ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô\n\n‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤ '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'"
                            },
                            {
                                inline_data: {
                                    mime_type: mimeType,
                                    data: imageBase64
                                }
                            }
                        ]
                    }],
                    generationConfig: {
                        temperature: 0.1,
                        topK: 32,
                        topP: 1,
                        maxOutputTokens: 1024,
                    }
                };

                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`Gemini API Error: ${response.status} - ${response.statusText}`);
                }

                const result = await response.json();
                console.log('‚úÖ Gemini API Response:', result);
                
                if (result.candidates && result.candidates[0] && result.candidates[0].content) {
                    const analysisText = result.candidates[0].content.parts[0].text;
                    return parseGeminiResponse(analysisText);
                } else {
                    console.warn('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å Gemini API');
                    return {
                        recipientName: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        amount: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        date: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        bank: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
                    };
                }
                
            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏•‡∏¥‡∏õ:', error);
                return {
                    recipientName: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    amount: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    date: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    bank: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    error: error.message
                };
            }
        }

        function parseGeminiResponse(text) {
            console.log('üìÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á Gemini:', text);
            
            const result = {
                recipientName: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                amount: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 
                date: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                bank: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
            };

            // ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            const lines = text.split('\n');
            lines.forEach(line => {
                const lowerLine = line.toLowerCase().trim();
                
                // ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
                if (lowerLine.includes('‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô') || lowerLine.includes('‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ') || lowerLine.includes('‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô')) {
                    const match = line.match(/[:Ôºö]\s*(.+)/);
                    if (match && match[1].trim() && !match[1].includes('‡πÑ‡∏°‡πà‡∏û‡∏ö')) {
                        result.recipientName = match[1].trim();
                    }
                }
                
                // ‡∏´‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
                if (lowerLine.includes('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô') || lowerLine.includes('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô')) {
                    const match = line.match(/[:Ôºö]\s*(.+)/);
                    if (match && match[1].trim() && !match[1].includes('‡πÑ‡∏°‡πà‡∏û‡∏ö')) {
                        result.amount = match[1].trim();
                    }
                }
                
                // ‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                if (lowerLine.includes('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà') || lowerLine.includes('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô')) {
                    const match = line.match(/[:Ôºö]\s*(.+)/);
                    if (match && match[1].trim() && !match[1].includes('‡πÑ‡∏°‡πà‡∏û‡∏ö')) {
                        result.date = match[1].trim();
                    }
                }
                
                // ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
                if (lowerLine.includes('‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£')) {
                    const match = line.match(/[:Ôºö]\s*(.+)/);
                    if (match && match[1].trim() && !match[1].includes('‡πÑ‡∏°‡πà‡∏û‡∏ö')) {
                        result.bank = match[1].trim();
                    }
                }
            });
            
            console.log('‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÑ‡∏î‡πâ:', result);
            return result;
        }

        async function performOCROnFirstImage(entryIndex) {
            const fileInput = document.getElementById(`file${entryIndex}`);
            if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
                console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ OCR');
                return null;
            }

            const file = fileInput.files[0]; // ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏£‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!file.type.startsWith('image/')) {
                console.log('‚ö†Ô∏è ‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏£‡∏Å‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏Ç‡πâ‡∏≤‡∏° OCR');
                return null;
            }

            try {
                console.log(`üîç ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥ OCR ‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: ${file.name}`);
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô base64
                const base64Data = await fileToBase64(file);
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Gemini Pro Vision
                const ocrResult = await analyzePaymentSlipWithGemini(base64Data, file.type);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå OCR
                displayOCRResult(entryIndex, ocrResult);
                
                return ocrResult;
                
            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ OCR:', error);
                displayOCRError(entryIndex, error.message);
                return null;
            }
        }

        function displayOCRResult(entryIndex, result) {
            const ocrContainer = document.getElementById(`ocrContent${entryIndex}`);
            if (!ocrContainer) return;

            if (result && result.recipientName && result.recipientName !== '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' && result.recipientName !== '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î') {
                ocrContainer.innerHTML = `
                    <div class="ocr-result success">
                        <h4>üéØ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏™‡∏•‡∏¥‡∏õ</h4>
                        <div class="recipient-info">
                            <h4>üë§ ${result.recipientName}</h4>
                            ${result.amount !== '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' ? `<p>üí∞ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ${result.amount}</p>` : ''}
                            ${result.date !== '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' ? `<p>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${result.date}</p>` : ''}
                            ${result.bank !== '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' ? `<p>üè¶ ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ${result.bank}</p>` : ''}
                        </div>
                    </div>
                `;
                console.log(`‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå OCR ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${result.recipientName}`);
            } else {
                ocrContainer.innerHTML = `
                    <div class="ocr-result error">
                        <h4>‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏î‡πâ</h4>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
                        ${result && result.error ? `<small>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${result.error}</small>` : ''}
                    </div>
                `;
                console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏î‡πâ');
            }
        }

        function displayOCRError(entryIndex, errorMessage) {
            const ocrContainer = document.getElementById(`ocrContent${entryIndex}`);
            if (!ocrContainer) return;

            ocrContainer.innerHTML = `
                <div class="ocr-result error">
                    <h4>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏•‡∏¥‡∏õ</h4>
                    <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ</p>
                    <small>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${errorMessage}</small>
                </div>
            `;
        }

        // ==================== ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ====================
        document.addEventListener('DOMContentLoaded', function() {
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô logo
            initializeLogo();
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LocalStorage
            loadNameListFromStorage();
            loadSubmittedUsers();
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sidebar
            updateSidebar();
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ default user type ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
            const userTypeSelect = document.getElementById('userType');
            userTypeSelect.value = 'employee';
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å
            addEntry();
            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
            renderNameList();
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ handleUserTypeChange ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ UI ‡∏ï‡∏≤‡∏° default
            handleUserTypeChange();
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Form Submit
            document.getElementById('paymentForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('nameForm').addEventListener('submit', handleNameSubmit);
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ User Type Change
            document.getElementById('userType').addEventListener('change', handleUserTypeChange);
        });

        // ==================== User Type Management ====================
        function handleUserTypeChange() {
            const userType = document.getElementById('userType').value;
            const addButton = document.querySelector('.btn-add');
            const entries = document.querySelectorAll('.entry-item');
            
            if (userType === 'employee') {
                // ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                if (addButton) {
                    addButton.style.display = 'none';
                }
                
                // ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏ô (‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏Ñ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å)
                if (entries.length > 1) {
                    for (let i = entries.length - 1; i > 0; i--) {
                        entries[i].remove();
                    }
                    updateEntryNumbers();
                }
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô
                updateEmployeePaymentDetails();
                
            } else if (userType === 'board_member') {
                // ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó: ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                if (addButton) {
                    addButton.style.display = 'inline-flex';
                }
                
                // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                clearAutoGeneratedDetails();
                
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô
                if (entries.length > 0) {
                    const firstEntry = entries[0];
                    const entryIndex = firstEntry.getAttribute('data-entry');
                    if (entryIndex) {
                        updateBoardMemberFirstEntryDetails(entryIndex);
                    }
                }
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
            entries.forEach(entry => {
                const entryIndex = entry.getAttribute('data-entry');
                if (entryIndex) {
                    updateFileUploadUI(entryIndex, userType);
                }
            });
        }
        
        function updateEmployeePaymentDetails() {
            const now = new Date();
            const currentMonth = now.getMonth(); // 0-11
            const currentYear = now.getFullYear();
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            const thaiMonths = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ ‡∏Ñ.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®.
            const lastMonthYearThai = lastMonthYear + 543;
            const currentYearThai = currentYear + 543;
            
            const paymentDetails = `‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[lastMonth]} ${lastMonthYearThai} ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[currentMonth]} ${currentYearThai})`;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å
            const firstDetailsInput = document.querySelector('#entriesContainer .entry-item textarea');
            if (firstDetailsInput) {
                firstDetailsInput.value = paymentDetails;
                firstDetailsInput.readOnly = true;
                firstDetailsInput.style.backgroundColor = '#f8f9fa';
            }
        }
        
        function updateBoardMemberFirstEntryDetails(entryIndex) {
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
            const paymentDetails = '‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏° 2568 ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô 2568)';
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏
            const detailsInput = document.getElementById(`details${entryIndex}`);
            if (detailsInput) {
                detailsInput.value = paymentDetails;
                detailsInput.readOnly = true;
                detailsInput.style.backgroundColor = '#f8f9fa';
            }
        }
        
        function clearAutoGeneratedDetails() {
            const allDetailsInputs = document.querySelectorAll('#entriesContainer .entry-item textarea');
            allDetailsInputs.forEach(input => {
                if (input.readOnly) {
                    input.value = '';
                    input.readOnly = false;
                    input.style.backgroundColor = '';
                }
            });
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
        function updateFileUploadUI(entryIndex, userType) {
            const fileInput = document.getElementById(`file${entryIndex}`);
            const fileLabel = document.getElementById(`fileLabel${entryIndex}`);
            const fileText = document.getElementById(`fileText${entryIndex}`);
            const fileSmall = document.getElementById(`fileSmall${entryIndex}`);
            
            if (userType === 'employee') {
                // ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå
                fileInput.setAttribute('multiple', 'multiple');
                fileLabel.textContent = 'üìÑ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô)';
                fileText.textContent = '‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå)';
                fileSmall.textContent = '‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG, PDF (‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10MB ‡∏ï‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå)';
            } else {
                // ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó: ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                fileInput.removeAttribute('multiple');
                fileLabel.textContent = 'üìÑ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ';
                fileText.textContent = '‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà';
                fileSmall.textContent = '‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG, PDF (‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10MB)';
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô
        function updatePaymentDetails(entryIndex) {
            const paymentTypeSelect = document.getElementById(`paymentType${entryIndex}`);
            const detailsTextarea = document.getElementById(`details${entryIndex}`);
            const dateRangeSection = document.getElementById(`dateRangeSection${entryIndex}`);
            const paymentType = paymentTypeSelect.value;
            
            // ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            if (dateRangeSection) {
                if (paymentType === 'facebook_ad') {
                    dateRangeSection.style.display = 'block';
                } else {
                    dateRangeSection.style.display = 'none';
                }
            }
            
            if (!paymentType) {
                detailsTextarea.value = '';
                return;
            }
            
            const now = new Date();
            const currentMonth = now.getMonth(); // 0-11
            const currentYear = now.getFullYear();
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            const thaiMonths = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ ‡∏Ñ.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®.
            const lastMonthYearThai = lastMonthYear + 543;
            const currentYearThai = currentYear + 543;
            
            let paymentDetails = '';
            
            switch (paymentType) {
                case 'bp_rental':
                    paymentDetails = `‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ BP ‡∏à‡∏≤‡∏Å LL (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[lastMonth]} ${lastMonthYearThai} ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[currentMonth]} ${currentYearThai})`;
                    break;
                case 'position_fee':
                    paymentDetails = `‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[lastMonth]} ${lastMonthYearThai} ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[currentMonth]} ${currentYearThai})`;
                    break;
                case 'facebook_ad':
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                    paymentDetails = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"';
                    break;
                default:
                    paymentDetails = '';
            }
            
            detailsTextarea.value = paymentDetails;
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ
        function updateFacebookAdDetails(entryIndex) {
            const startDay = document.getElementById(`startDay${entryIndex}`).value;
            const startMonth = document.getElementById(`startMonth${entryIndex}`).value;
            const endDay = document.getElementById(`endDay${entryIndex}`).value;
            const endMonth = document.getElementById(`endMonth${entryIndex}`).value;
            const detailsTextarea = document.getElementById(`details${entryIndex}`);
            
            if (!startDay || startMonth === '' || !endDay || endMonth === '') {
                showResult('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
            const thaiMonthsShort = [
                '‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.',
                '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'
            ];
            
            const paymentDetails = `‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ ${startDay} ${thaiMonthsShort[parseInt(startMonth)]} - ${endDay} ${thaiMonthsShort[parseInt(endMonth)]}`;
            detailsTextarea.value = paymentDetails;
        }
        
        // ==================== Multiple Payment Types Management ====================
        let paymentTypeCount = 0;
        
        function addPaymentType(entryIndex) {
            const container = document.getElementById(`paymentTypesContainer${entryIndex}`);
            paymentTypeCount++;
            const paymentTypeId = `${entryIndex}_${paymentTypeCount}`;
            
            const paymentTypeHTML = `
                <div class="payment-type-item" id="paymentTypeItem_${paymentTypeId}" style="background: #f8f9ff; border: 2px solid #e6e8ff; border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h5 style="color: #667eea; margin: 0;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô #${paymentTypeCount}</h5>
                        <button type="button" class="btn btn-small" onclick="removePaymentType('${paymentTypeId}')" style="background: #ff6b6b;">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 15px;">
                        <select id="paymentType_${paymentTypeId}" onchange="updateMultiplePaymentDetails(${entryIndex}, '${paymentTypeId}')" required>
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô --</option>
                            <option value="bp_rental">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ BP ‡∏à‡∏≤‡∏Å LL</option>
                            <option value="position_fee">‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</option>
                            <option value="facebook_ad">‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ</option>
                        </select>
                    </div>
                    
                    <div id="dateRangeSection_${paymentTypeId}" class="form-group" style="display:none;">
                        <label>üìÖ ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ)</label>
                        <div class="date-range-container">
                            <input type="number" id="startDay_${paymentTypeId}" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" min="1" max="31" style="width: 80px;">
                            <select id="startMonth_${paymentTypeId}" style="width: 120px;">
                                <option value="">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                                <option value="0">‡∏°.‡∏Ñ.</option>
                                <option value="1">‡∏Å.‡∏û.</option>
                                <option value="2">‡∏°‡∏µ.‡∏Ñ.</option>
                                <option value="3">‡πÄ‡∏°.‡∏¢.</option>
                                <option value="4">‡∏û.‡∏Ñ.</option>
                                <option value="5">‡∏°‡∏¥.‡∏¢.</option>
                                <option value="6">‡∏Å.‡∏Ñ.</option>
                                <option value="7">‡∏™.‡∏Ñ.</option>
                                <option value="8">‡∏Å.‡∏¢.</option>
                                <option value="9">‡∏ï.‡∏Ñ.</option>
                                <option value="10">‡∏û.‡∏¢.</option>
                                <option value="11">‡∏ò.‡∏Ñ.</option>
                            </select>
                            <span class="date-range-separator">-</span>
                            <input type="number" id="endDay_${paymentTypeId}" placeholder="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" min="1" max="31" style="width: 80px;">
                            <select id="endMonth_${paymentTypeId}" style="width: 120px;">
                                <option value="">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                                <option value="0">‡∏°.‡∏Ñ.</option>
                                <option value="1">‡∏Å.‡∏û.</option>
                                <option value="2">‡∏°‡∏µ.‡∏Ñ.</option>
                                <option value="3">‡πÄ‡∏°.‡∏¢.</option>
                                <option value="4">‡∏û.‡∏Ñ.</option>
                                <option value="5">‡∏°‡∏¥.‡∏¢.</option>
                                <option value="6">‡∏Å.‡∏Ñ.</option>
                                <option value="7">‡∏™.‡∏Ñ.</option>
                                <option value="8">‡∏Å.‡∏¢.</option>
                                <option value="9">‡∏ï.‡∏Ñ.</option>
                                <option value="10">‡∏û.‡∏¢.</option>
                                <option value="11">‡∏ò.‡∏Ñ.</option>
                            </select>
                            <button type="button" onclick="updateMultipleFacebookAdDetails(${entryIndex}, '${paymentTypeId}')" class="btn btn-small" style="background: #28a745;">
                                ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                        <textarea id="paymentDetails_${paymentTypeId}" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô" readonly style="background-color: #f8f9fa;"></textarea>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', paymentTypeHTML);
        }
        
        function removePaymentType(paymentTypeId) {
            const item = document.getElementById(`paymentTypeItem_${paymentTypeId}`);
            if (item) {
                item.remove();
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏ß‡∏°
                const entryIndex = paymentTypeId.split('_')[0];
                updateCombinedPaymentDetails(entryIndex);
            }
        }
        
        function updateMultiplePaymentDetails(entryIndex, paymentTypeId) {
            const paymentTypeSelect = document.getElementById(`paymentType_${paymentTypeId}`);
            const detailsTextarea = document.getElementById(`paymentDetails_${paymentTypeId}`);
            const dateRangeSection = document.getElementById(`dateRangeSection_${paymentTypeId}`);
            const paymentType = paymentTypeSelect.value;
            
            // ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            if (dateRangeSection) {
                if (paymentType === 'facebook_ad') {
                    dateRangeSection.style.display = 'block';
                } else {
                    dateRangeSection.style.display = 'none';
                }
            }
            
            if (!paymentType) {
                detailsTextarea.value = '';
                updateCombinedPaymentDetails(entryIndex);
                return;
            }
            
            const now = new Date();
            const currentMonth = now.getMonth(); // 0-11
            const currentYear = now.getFullYear();
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            const thaiMonths = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];
            
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ ‡∏Ñ.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®.
            const lastMonthYearThai = lastMonthYear + 543;
            const currentYearThai = currentYear + 543;
            
            let paymentDetails = '';
            
            switch (paymentType) {
                case 'bp_rental':
                    paymentDetails = `‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ BP ‡∏à‡∏≤‡∏Å LL (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[lastMonth]} ${lastMonthYearThai} ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[currentMonth]} ${currentYearThai})`;
                    break;
                case 'position_fee':
                    paymentDetails = `‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[lastMonth]} ${lastMonthYearThai} ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[currentMonth]} ${currentYearThai})`;
                    break;
                case 'facebook_ad':
                    paymentDetails = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"';
                    break;
                default:
                    paymentDetails = '';
            }
            
            detailsTextarea.value = paymentDetails;
            updateCombinedPaymentDetails(entryIndex);
        }
        
        function updateMultipleFacebookAdDetails(entryIndex, paymentTypeId) {
            const startDay = document.getElementById(`startDay_${paymentTypeId}`).value;
            const startMonth = document.getElementById(`startMonth_${paymentTypeId}`).value;
            const endDay = document.getElementById(`endDay_${paymentTypeId}`).value;
            const endMonth = document.getElementById(`endMonth_${paymentTypeId}`).value;
            const detailsTextarea = document.getElementById(`paymentDetails_${paymentTypeId}`);
            
            if (!startDay || startMonth === '' || !endDay || endMonth === '') {
                showResult('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
            const thaiMonthsShort = [
                '‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.',
                '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'
            ];
            
            const paymentDetails = `‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ ${startDay} ${thaiMonthsShort[parseInt(startMonth)]} - ${endDay} ${thaiMonthsShort[parseInt(endMonth)]}`;
            detailsTextarea.value = paymentDetails;
            updateCombinedPaymentDetails(entryIndex);
        }
        
        function updateCombinedPaymentDetails(entryIndex) {
            const container = document.getElementById(`paymentTypesContainer${entryIndex}`);
            const combinedDetailsTextarea = document.getElementById(`details${entryIndex}`);
            
            if (!container || !combinedDetailsTextarea) return;
            
            const paymentTypeItems = container.querySelectorAll('.payment-type-item');
            const details = [];
            
            paymentTypeItems.forEach(item => {
                const textarea = item.querySelector('textarea[id^="paymentDetails_"]');
                if (textarea && textarea.value.trim()) {
                    details.push(textarea.value.trim());
                }
            });
            
            combinedDetailsTextarea.value = details.join('\n');
        }

        // ==================== Tab Functions ====================
        function switchTab(tabId, buttonElement) {
            // ‡∏ã‡πà‡∏≠‡∏ô tab ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => tab.classList.remove('active'));
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏° active ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const allButtons = document.querySelectorAll('.tab-btn');
            allButtons.forEach(btn => btn.classList.remove('active'));
            
            // ‡πÅ‡∏™‡∏î‡∏á tab ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            document.getElementById(tabId).classList.add('active');
            buttonElement.classList.add('active');
        }

        // ==================== Entry Management ====================
        function addEntry() {
            const userType = document.getElementById('userType').value;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°
            if (userType === 'employee') {
                const existingEntries = document.querySelectorAll('.entry-item');
                if (existingEntries.length >= 1) {
                    showResult('‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                    return;
                }
            }
            
            const container = document.getElementById('entriesContainer');
            entryCount++;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
            const existingEntries = document.querySelectorAll('.entry-item');
            const isFirstEntry = existingEntries.length === 0;
            const isBoardMember = userType === 'board_member';
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
            let detailsHTML = '';
            if (isBoardMember && !isFirstEntry) {
                // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ
                detailsHTML = `
                    <div class="form-group">
                        <label>üìù ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</label>
                        <div id="paymentTypesContainer${entryCount}">
                            <!-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                        </div>
                        <button type="button" class="btn btn-small btn-add" onclick="addPaymentType(${entryCount})" style="margin-top: 10px;">
                            ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô
                        </button>
                    </div>
                    <div class="form-group">
                        <label>üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏ß‡∏°</label>
                        <textarea id="details${entryCount}" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" required readonly></textarea>
                    </div>
                `;
            } else {
                // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                detailsHTML = `
                    <div class="form-group">
                        <label>üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                        <textarea id="details${entryCount}" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" required></textarea>
                    </div>
                `;
            }
            
            const entryHTML = `
                <div class="entry-item" data-entry="${entryCount}">
                    <div class="entry-header">
                        <h4>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${entryCount}</h4>
                        <button type="button" class="btn-remove-entry" onclick="removeEntry(${entryCount})" ${entryCount === 1 ? 'style="display:none"' : ''}>
                            üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                        </button>
                    </div>

                    <!-- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ -->
                    <div class="form-group">
                        <label id="fileLabel${entryCount}">üìÑ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</label>
                        <div class="file-upload" id="fileUpload${entryCount}">
                            <input type="file" id="file${entryCount}" accept="image/*,.pdf" required>
                            <div class="file-upload-content">
                                <div class="file-upload-icon">üìé</div>
                                <p id="fileText${entryCount}">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                                <small id="fileSmall${entryCount}">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG, PDF (‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10MB)</small>
                            </div>
                            <div class="file-info" style="display:none;"></div>
                        </div>
                    </div>

                    <!-- OCR Result Display -->
                    <div class="form-group">
                        <div id="ocrContent${entryCount}" class="ocr-container">
                            <!-- OCR results will be displayed here -->
                        </div>
                    </div>

                    ${detailsHTML}
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', entryHTML);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            updateFileUploadUI(entryCount, userType);
            
            setupFileUpload(entryCount);
            updateEntryNumbers();
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            if (userType === 'employee') {
                updateEmployeePaymentDetails();
            } else if (userType === 'board_member' && existingEntries.length === 0) {
                // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
                updateBoardMemberFirstEntryDetails(entryCount);
            } else if (userType === 'board_member' && !isFirstEntry) {
                // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏£‡∏Å
                addPaymentType(entryCount);
            }
        }

        function removeEntry(entryIndex) {
            const userType = document.getElementById('userType').value;
            const entries = document.querySelectorAll('.entry-item');
            
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏ö
            if (userType === 'employee' && entries.length <= 1) {
                showResult('‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'error');
                return;
            }
            
            const entryElement = document.querySelector(`[data-entry="${entryIndex}"]`);
            if (entryElement) {
                entryElement.remove();
                updateEntryNumbers();
            }
        }

        function updateEntryNumbers() {
            const entries = document.querySelectorAll('.entry-item');
            const userType = document.getElementById('userType').value;
            
            entries.forEach((entry, index) => {
                const header = entry.querySelector('.entry-header h4');
                header.textContent = `üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${index + 1}`;
                
                // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
                const removeBtn = entry.querySelector('.btn-remove-entry');
                if (userType === 'employee') {
                    // ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡πÄ‡∏™‡∏°‡∏≠
                    removeBtn.style.display = 'none';
                } else if (entries.length > 1) {
                    // ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó: ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    removeBtn.style.display = 'block';
                } else {
                    removeBtn.style.display = 'none';
                }
            });
        }

        function setupFileUpload(entryIndex) {
            const fileUpload = document.getElementById(`fileUpload${entryIndex}`);
            const fileInput = document.getElementById(`file${entryIndex}`);
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ drag & drop
            fileUpload.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            fileUpload.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });
            
            fileUpload.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files, entryIndex);
                }
            });
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ file input change
            fileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    handleFileSelect(this.files, entryIndex);
                }
            });
        }

        function handleFileSelect(files, entryIndex) {
            const fileUpload = document.getElementById(`fileUpload${entryIndex}`);
            const fileInput = document.getElementById(`file${entryIndex}`);
            const fileInfo = fileUpload.querySelector('.file-info');
            
            // Convert FileList to Array
            const fileArray = Array.from(files);
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'application/pdf'];
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå
            for (let file of fileArray) {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (10MB)
                if (file.size > 10 * 1024 * 1024) {
                    showResult(`‡πÑ‡∏ü‡∏•‡πå "${file.name}" ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà`, 'error');
                    return;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå
                if (!allowedTypes.includes(file.type)) {
                    showResult(`‡πÑ‡∏ü‡∏•‡πå "${file.name}" ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó JPG, PNG ‡∏´‡∏£‡∏∑‡∏≠ PDF ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô`, 'error');
                    return;
                }
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            fileUpload.classList.add('file-selected');
            fileInfo.style.display = 'block';
            
            if (fileArray.length === 1) {
                // ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                const file = fileArray[0];
                fileInfo.innerHTML = `
                    <strong>üìé ${file.name}</strong><br>
                    ‡∏Ç‡∏ô‡∏≤‡∏î: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${file.type}
                `;
            } else {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå
                let totalSize = fileArray.reduce((sum, file) => sum + file.size, 0);
                let fileListHtml = fileArray.map(file => 
                    `<div class="file-item">
                        <strong>üìé ${file.name}</strong><br>
                        <small>‡∏Ç‡∏ô‡∏≤‡∏î: ${(file.size / 1024 / 1024).toFixed(2)} MB | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${file.type}</small>
                    </div>`
                ).join('');
                
                fileInfo.innerHTML = `
                    <div class="files-summary">
                        üìé ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß ${fileArray.length} ‡πÑ‡∏ü‡∏•‡πå<br>
                        <small>‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏ß‡∏°: ${(totalSize / 1024 / 1024).toFixed(2)} MB</small>
                    </div>
                    ${fileListHtml}
                `;
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï file input (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö multiple files)
            const dt = new DataTransfer();
            fileArray.forEach(file => dt.items.add(file));
            fileInput.files = dt.files;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á image previews
            createImagePreviews(fileArray, entryIndex);
            
            // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥ OCR ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ - ‡∏à‡∏∞‡∏ó‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            // setTimeout(() => {
            //     performOCROnFirstImage(entryIndex);
            // }, 500);
        }

        // ==================== Form Submission ====================
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            const userType = document.getElementById('userType').value;
            if (!userType) {
                showResult('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'error');
                return;
            }
            
            const entries = document.querySelectorAll('.entry-item');
            if (entries.length === 0) {
                showResult('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'error');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            if (userType === 'employee' && entries.length > 1) {
                showResult('‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            let isValid = true;
            const entriesData = [];
            
            for (let i = 0; i < entries.length; i++) {
                const entry = entries[i];
                const entryIndex = entry.getAttribute('data-entry');
                const fileInput = document.getElementById(`file${entryIndex}`);
                const detailsInput = document.getElementById(`details${entryIndex}`);
                const paymentTypeSelect = document.getElementById(`paymentType${entryIndex}`);
                
                if (!fileInput.files || fileInput.files.length === 0) {
                    showResult(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`, 'error');
                    isValid = false;
                    break;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ)
                if (paymentTypeSelect && !paymentTypeSelect.value.trim()) {
                    showResult(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`, 'error');
                    isValid = false;
                    break;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ)
                const paymentTypesContainer = document.getElementById(`paymentTypesContainer${entryIndex}`);
                if (paymentTypesContainer) {
                    const paymentTypeItems = paymentTypesContainer.querySelectorAll('.payment-type-item');
                    if (paymentTypeItems.length === 0) {
                        showResult(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`, 'error');
                        isValid = false;
                        break;
                    }
                    
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô
                    for (let j = 0; j < paymentTypeItems.length; j++) {
                        const item = paymentTypeItems[j];
                        const paymentTypeId = item.id.replace('paymentTypeItem_', '');
                        const select = document.getElementById(`paymentType_${paymentTypeId}`);
                        const details = document.getElementById(`paymentDetails_${paymentTypeId}`);
                        
                        if (!select || !select.value.trim()) {
                            showResult(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`, 'error');
                            isValid = false;
                            break;
                        }
                        
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ
                        if (select.value === 'facebook_ad') {
                            const startDay = document.getElementById(`startDay_${paymentTypeId}`);
                            const startMonth = document.getElementById(`startMonth_${paymentTypeId}`);
                            const endDay = document.getElementById(`endDay_${paymentTypeId}`);
                            const endMonth = document.getElementById(`endMonth_${paymentTypeId}`);
                            
                            if (!startDay || !startDay.value || 
                                !startMonth || startMonth.value === '' || 
                                !endDay || !endDay.value || 
                                !endMonth || endMonth.value === '') {
                                showResult(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢ "‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ" ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`, 'error');
                                isValid = false;
                                break;
                            }
                        }
                        
                        if (!details || !details.value.trim()) {
                            showResult(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`, 'error');
                            isValid = false;
                            break;
                        }
                    }
                    
                    if (!isValid) break;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ (‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏° - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ multiple payment types)
                if (paymentTypeSelect && paymentTypeSelect.value === 'facebook_ad') {
                    const startDay = document.getElementById(`startDay${entryIndex}`);
                    const startMonth = document.getElementById(`startMonth${entryIndex}`);
                    const endDay = document.getElementById(`endDay${entryIndex}`);
                    const endMonth = document.getElementById(`endMonth${entryIndex}`);
                    
                    if (!startDay || !startDay.value || 
                        !startMonth || startMonth.value === '' || 
                        !endDay || !endDay.value || 
                        !endMonth || endMonth.value === '') {
                        showResult(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`, 'error');
                        isValid = false;
                        break;
                    }
                }
                
                if (!detailsInput.value.trim()) {
                    showResult(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`, 'error');
                    isValid = false;
                    break;
                }
                
                try {
                    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå
                    const files = Array.from(fileInput.files);
                    const slips = [];
                    
                    for (let file of files) {
                        const fileBase64 = await fileToBase64(file);
                        slips.push({
                            filename: file.name,
                            mimetype: file.type,
                            size: file.size,
                            data: fileBase64
                        });
                    }
                    
                    const entryData = {
                        entryNumber: i + 1,
                        slip: files.length === 1 ? slips[0] : slips, // ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô object ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß, array ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå
                        slips: slips, // ‡πÄ‡∏Å‡πá‡∏ö array ‡πÑ‡∏ß‡πâ‡πÄ‡∏™‡∏°‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
                        fileCount: files.length,
                        details: detailsInput.value.trim()
                    };
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ)
                    const paymentTypesContainer = document.getElementById(`paymentTypesContainer${entryIndex}`);
                    if (paymentTypesContainer) {
                        const paymentTypeItems = paymentTypesContainer.querySelectorAll('.payment-type-item');
                        const multiplePaymentTypes = [];
                        
                        paymentTypeItems.forEach(item => {
                            const paymentTypeId = item.id.replace('paymentTypeItem_', '');
                            const select = document.getElementById(`paymentType_${paymentTypeId}`);
                            const details = document.getElementById(`paymentDetails_${paymentTypeId}`);
                            
                            if (select && select.value && details && details.value.trim()) {
                                const paymentTypeData = {
                                    id: paymentTypeId,
                                    type: select.value,
                                    details: details.value.trim()
                                };
                                
                                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ
                                if (select.value === 'facebook_ad') {
                                    const startDay = document.getElementById(`startDay_${paymentTypeId}`);
                                    const startMonth = document.getElementById(`startMonth_${paymentTypeId}`);
                                    const endDay = document.getElementById(`endDay_${paymentTypeId}`);
                                    const endMonth = document.getElementById(`endMonth_${paymentTypeId}`);
                                    
                                    paymentTypeData.dateRange = {
                                        startDay: startDay ? startDay.value : '',
                                        startMonth: startMonth ? startMonth.value : '',
                                        endDay: endDay ? endDay.value : '',
                                        endMonth: endMonth ? endMonth.value : ''
                                    };
                                }
                                
                                multiplePaymentTypes.push(paymentTypeData);
                            }
                        });
                        
                        entryData.multiplePaymentTypes = multiplePaymentTypes;
                        entryData.hasMultiplePaymentTypes = true;
                    }
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°)
                    if (paymentTypeSelect) {
                        entryData.paymentType = paymentTypeSelect.value;
                        entryData.hasMultiplePaymentTypes = false;
                        
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏≠‡∏î‡πÄ‡∏ü‡∏ã‡∏ö‡∏∏‡∏Ñ
                        if (paymentTypeSelect.value === 'facebook_ad') {
                            const startDay = document.getElementById(`startDay${entryIndex}`);
                            const startMonth = document.getElementById(`startMonth${entryIndex}`);
                            const endDay = document.getElementById(`endDay${entryIndex}`);
                            const endMonth = document.getElementById(`endMonth${entryIndex}`);
                            
                            entryData.dateRange = {
                                startDay: startDay ? startDay.value : '',
                                startMonth: startMonth ? startMonth.value : '',
                                endDay: endDay ? endDay.value : '',
                                endMonth: endMonth ? endMonth.value : ''
                            };
                        }
                    }
                    
                    entriesData.push(entryData);
                } catch (error) {
                    showResult(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà ${i + 1}`, 'error');
                    isValid = false;
                    break;
                }
            }
            
            if (!isValid) return;
            
            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á
            const submitData = {
                userType: userType,
                entries: entriesData,
                nameList: nameList,
                submittedAt: new Date().toISOString(),
                formMode: "multiple-entries",
                totalEntries: entriesData.length
            };
            
            // ‡πÅ‡∏™‡∏î‡∏á loading
            showLoading(true);
            showProgress(0);
            
            try {
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ debug ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                console.log('UserType:', userType);
                console.log('EntriesData:', entriesData);
                console.log('SubmitData:', submitData);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const isEmployee = userType === 'employee';
                const hasOneEntry = entriesData.length === 1;
                const hasMultipleFiles = entriesData[0] && entriesData[0].fileCount > 1;
                
                console.log('Is Employee:', isEmployee);
                console.log('Has One Entry:', hasOneEntry);
                console.log('Has Multiple Files:', hasMultipleFiles);
                
                const isEmployeeWithMultipleFiles = isEmployee && hasOneEntry && hasMultipleFiles;
                console.log('Process as Multiple Files:', isEmployeeWithMultipleFiles);
                
                if (isEmployeeWithMultipleFiles) {
                    // ‡∏™‡πà‡∏á‡∏ó‡∏µ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                    console.log('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå');
                    await processEmployeeMultipleFiles(submitData, entriesData[0]);
                } else {
                    // ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                    console.log('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥');
                    await processSingleSubmission(submitData);
                }
                
            } catch (error) {
                console.error('Error:', error);
                showLoading(false);
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
                let errorMessage = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                if (error.message.includes('Failed to fetch')) {
                    errorMessage += ' - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ';
                } else if (error.message.includes('HTTP Error')) {
                    errorMessage += ` - ${error.message}`;
                }
                errorMessage += ' ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
                
                showResult(errorMessage, 'error');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• OCR ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
        async function processOCRInBackground(ocrData) {
            console.log('üîç ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• OCR ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á...');
            
            try {
                const firstEntry = ocrData.entries[0];
                if (!firstEntry || !firstEntry.slips || firstEntry.slips.length === 0) {
                    console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö OCR');
                    return;
                }
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                const isEmployee = ocrData.userType === 'employee';
                
                if (isEmployee) {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                    await processAllImageFilesOCR(firstEntry, ocrData);
                } else {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£: ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏£‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                    await processSingleImageOCR(firstEntry, ocrData);
                }
                
            } catch (error) {
                console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô OCR ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á:', error);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£)
        async function processSingleImageOCR(entry, ocrData) {
            // ‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏£‡∏Å
            const imageFile = entry.slips.find(slip => slip.mimetype && slip.mimetype.startsWith('image/'));
            if (!imageFile) {
                console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö OCR');
                return;
            }
            
            console.log(`üñºÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå: ${imageFile.filename}`);
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Gemini OCR
            const ocrResult = await analyzePaymentSlipWithGemini(imageFile.data, imageFile.mimetype);
            
            // ‡∏ñ‡πâ‡∏≤ OCR ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
            if (ocrResult && ocrResult.recipientName && 
                ocrResult.recipientName !== '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' && 
                ocrResult.recipientName !== '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î') {
                
                console.log(`‚úÖ OCR ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô - ${ocrResult.recipientName}`);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á sidebar ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
                addSubmittedUser(ocrResult.recipientName, {
                    ocrResult: ocrResult,
                    entries: ocrData.entries,
                    userType: ocrData.userType,
                    processedAt: new Date(),
                    processedFiles: [imageFile.filename]
                });
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå OCR ‡πÉ‡∏ô console
                console.log('üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ:', {
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô: ocrResult.recipientName,
                    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ocrResult.amount,
                    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ocrResult.date,
                    ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ocrResult.bank
                });
            } else {
                console.log('‚ö†Ô∏è OCR ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ó‡∏∏‡∏Å‡πÑ‡∏ü‡∏•‡πå (‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)
        async function processAllImageFilesOCR(entry, ocrData) {
            // ‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const imageFiles = entry.slips.filter(slip => slip.mimetype && slip.mimetype.startsWith('image/'));
            if (imageFiles.length === 0) {
                console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö OCR');
                return;
            }
            
            console.log(`üñºÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• ${imageFiles.length} ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...`);
            
            const allOCRResults = [];
            const processedFileNames = [];
            
            // ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ó‡∏µ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå
            for (let i = 0; i < imageFiles.length; i++) {
                const imageFile = imageFiles[i];
                console.log(`üìÑ ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ${i + 1}/${imageFiles.length}: ${imageFile.filename}`);
                
                try {
                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Gemini OCR
                    const ocrResult = await analyzePaymentSlipWithGemini(imageFile.data, imageFile.mimetype);
                    
                    if (ocrResult && ocrResult.recipientName && 
                        ocrResult.recipientName !== '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' && 
                        ocrResult.recipientName !== '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î') {
                        
                        allOCRResults.push({
                            ...ocrResult,
                            filename: imageFile.filename,
                            fileIndex: i + 1
                        });
                        processedFileNames.push(imageFile.filename);
                        
                        console.log(`‚úÖ OCR ‡πÑ‡∏ü‡∏•‡πå ${i + 1} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${ocrResult.recipientName}`);
                    } else {
                        console.log(`‚ö†Ô∏è OCR ‡πÑ‡∏ü‡∏•‡πå ${i + 1} ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${imageFile.filename}`);
                    }
                    
                    // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
                    if (i < imageFiles.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                    
                } catch (error) {
                    console.error(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô OCR ‡πÑ‡∏ü‡∏•‡πå ${i + 1}:`, error);
                }
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏£‡∏ß‡∏°
            if (allOCRResults.length > 0) {
                console.log(`üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå OCR: ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${allOCRResults.length}/${imageFiles.length} ‡πÑ‡∏ü‡∏•‡πå`);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏ö
                const uniqueRecipients = [];
                
                allOCRResults.forEach(result => {
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
                    const existingRecipient = uniqueRecipients.find(r => 
                        r.recipientName.toLowerCase().includes(result.recipientName.toLowerCase()) ||
                        result.recipientName.toLowerCase().includes(r.recipientName.toLowerCase())
                    );
                    
                    if (!existingRecipient) {
                        uniqueRecipients.push(result);
                    }
                });
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á sidebar
                uniqueRecipients.forEach((result, index) => {
                    setTimeout(() => {
                        addSubmittedUser(result.recipientName, {
                            ocrResult: result,
                            entries: ocrData.entries,
                            userType: ocrData.userType,
                            processedAt: new Date(),
                            processedFiles: processedFileNames,
                            allOCRResults: allOCRResults,
                            isMultipleFiles: true
                        });
                        
                        console.log(`üë§ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô: ${result.recipientName} (‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå ${result.filename})`);
                    }, index * 500); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏∏‡∏Å 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                });
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏ô console
                console.log('üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:', allOCRResults.map(r => ({
                    ‡πÑ‡∏ü‡∏•‡πå: r.filename,
                    ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô: r.recipientName,
                    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: r.amount,
                    ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: r.date,
                    ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: r.bank
                })));
                
            } else {
                console.log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏î‡πÜ ‡πÑ‡∏î‡πâ');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ
        function resetSubmittedUsers() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                submittedUsers = [];
                saveSubmittedUsers();
                updateSidebar();
                showResult('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                console.log('üóëÔ∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß');
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥
        async function processSingleSubmission(submitData) {
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï progress
            showProgress(25);
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô console ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ debug
            console.log('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á:', submitData);
            
            const response = await fetch('http://localhost:5678/webhook/payment-process', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(submitData)
            });
            
            showProgress(75);
            
            if (response.ok) {
                const result = await response.json();
                showProgress(100);
                
                setTimeout(() => {
                    showLoading(false);
                    showResult('‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
                    
                    // ‡∏ó‡∏≥ OCR ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sidebar ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
                    const ocrProcessingData = {
                        entries: submitData.entries,
                        userType: submitData.userType
                    };
                    processOCRInBackground(ocrProcessingData);
                    
                    resetAllEntries();
                }, 500);
            } else {
                throw new Error(`HTTP Error: ${response.status} - ${response.statusText}`);
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå (‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)
        async function processEmployeeMultipleFiles(baseSubmitData, entryData) {
            const files = entryData.slips;
            const totalFiles = files.length;
            let successCount = 0;
            let failedFiles = [];
            
            const estimatedTime = (totalFiles - 1) * 30; // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πà‡∏ß‡∏á (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
            const estimatedMinutes = Math.ceil(estimatedTime / 60);
            
            console.log(`üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${totalFiles} ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå (‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå)`);
            console.log(`‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: ${estimatedTime} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (${estimatedMinutes} ‡∏ô‡∏≤‡∏ó‡∏µ)`);
            
            for (let i = 0; i < totalFiles; i++) {
                const currentFile = files[i];
                const fileNumber = i + 1;
                
                try {
                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì progress ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                    const baseProgress = 25;
                    const progressPerFile = 70 / totalFiles; // 70% ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    const currentProgress = baseProgress + (progressPerFile * i);
                    
                    showProgress(currentProgress);
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
                    const singleFileData = {
                        ...baseSubmitData,
                        entries: [{
                            entryNumber: 1,
                            slip: currentFile,
                            slips: [currentFile],
                            fileCount: 1,
                            fileNumber: fileNumber, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÑ‡∏ü‡∏•‡πå
                            totalFiles: totalFiles, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            details: entryData.details
                        }],
                        totalEntries: 1,
                        currentFileIndex: i,
                        isMultiFileProcess: true
                    };
                    
                    console.log(`üìÑ ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ${fileNumber}/${totalFiles}: ${currentFile.filename}`);
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° loading
                    const loadingSection = document.getElementById('loadingSection');
                    const loadingText = loadingSection.querySelector('p');
                    if (loadingText) {
                        loadingText.innerHTML = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...<br><small>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ${fileNumber}/${totalFiles}: ${currentFile.filename}</small>`;
                    }
                    
                    console.log(`üì§ ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ${fileNumber}/${totalFiles}:`, singleFileData);
                    
                    const response = await fetch('http://localhost:5678/webhook/payment-process', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(singleFileData)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        successCount++;
                        console.log(`‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ${fileNumber} ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:`, result);
                    } else {
                        throw new Error(`HTTP Error: ${response.status} - ${response.statusText}`);
                    }
                    
                    // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
                    if (i < totalFiles - 1) {
                        console.log(`‚è≥ ‡∏£‡∏≠ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ...`);
                        
                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á
                        for (let countdown = 30; countdown > 0; countdown--) {
                            const loadingText = loadingSection.querySelector('p');
                            if (loadingText) {
                                loadingText.innerHTML = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...<br><small>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ${fileNumber}/${totalFiles} ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</small><br><strong>‚è∞ ‡∏£‡∏≠ ${countdown} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</strong>`;
                            }
                            
                            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï progress bar ‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏£‡∏≠
                            const waitProgress = currentProgress + (progressPerFile * (30 - countdown) / 30 * 0.5);
                            showProgress(waitProgress);
                            
                            await new Promise(resolve => setTimeout(resolve, 1000));
                        }
                        
                        console.log(`üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ...`);
                    }
                    
                } catch (error) {
                    console.error(`‚ùå ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ${fileNumber} ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:`, error);
                    failedFiles.push({
                        fileNumber: fileNumber,
                        filename: currentFile.filename,
                        error: error.message
                    });
                }
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            showProgress(100);
            
            setTimeout(() => {
                showLoading(false);
                
                if (successCount === totalFiles) {
                    showResult(`‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î! ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• ${totalFiles} ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
                    
                    // ‡∏ó‡∏≥ OCR ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sidebar ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á
                    const ocrProcessingData = {
                        entries: [entryData],
                        userType: baseSubmitData.userType
                    };
                    processOCRInBackground(ocrProcessingData);
                    
                    resetAllEntries();
                } else if (successCount > 0) {
                    const failedList = failedFiles.map(f => f.filename).join(', ');
                    showResult(`‚ö†Ô∏è ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount}/${totalFiles} ‡πÑ‡∏ü‡∏•‡πå | ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${failedList}`, 'error');
                } else {
                    showResult(`‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á`, 'error');
                }
            }, 500);
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function resetAllEntries() {
            const container = document.getElementById('entriesContainer');
            container.innerHTML = '';
            entryCount = 0;
            addEntry();
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            handleUserTypeChange();
        }

        // ==================== Name Management ====================
        function renderNameList() {
            const container = document.getElementById('namesList');
            container.innerHTML = '';
            
            nameList.forEach((person, index) => {
                const nameHTML = `
                    <div class="name-item">
                        <h4>üë§ ${person.name}</h4>
                        ${person.position ? `<p>üíº ${person.position}</p>` : ''}
                        ${person.department ? `<p>üè¢ ${person.department}</p>` : ''}
                        ${person.notes ? `<p>üìù ${person.notes}</p>` : ''}
                        <div class="name-actions">
                            <button class="btn btn-small btn-edit" onclick="editName(${index})">
                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button class="btn btn-small btn-delete" onclick="deleteName(${index})">
                                üóëÔ∏è ‡∏•‡∏ö
                            </button>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', nameHTML);
            });
        }

        function openAddModal() {
            editingIndex = -1;
            document.getElementById('modalTitle').textContent = 'üìÅ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('nameForm').reset();
            document.getElementById('nameModal').classList.add('show');
        }

        function editName(index) {
            editingIndex = index;
            const person = nameList[index];
            
            document.getElementById('modalTitle').textContent = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠';
            document.getElementById('nameInput').value = person.name;
            document.getElementById('positionInput').value = person.position || '';
            document.getElementById('departmentInput').value = person.department || '';
            document.getElementById('notesInput').value = person.notes || '';
            
            document.getElementById('nameModal').classList.add('show');
        }

        function deleteName(index) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                nameList.splice(index, 1);
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á LocalStorage
                saveNameListToStorage();
                
                renderNameList();
                showResult('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        function closeModal() {
            document.getElementById('nameModal').classList.remove('show');
            editingIndex = -1;
        }

        function handleNameSubmit(e) {
            e.preventDefault();
            
            const name = document.getElementById('nameInput').value.trim();
            const position = document.getElementById('positionInput').value.trim();
            const department = document.getElementById('departmentInput').value.trim();
            const notes = document.getElementById('notesInput').value.trim();
            
            if (!name) {
                showResult('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', 'error');
                return;
            }
            
            const personData = { name, position, department, notes };
            
            if (editingIndex >= 0) {
                nameList[editingIndex] = personData;
                showResult('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            } else {
                nameList.push(personData);
                showResult('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á LocalStorage
            saveNameListToStorage();
            
            renderNameList();
            closeModal();
        }

        // ==================== UI Helper Functions ====================
        function showLoading(show) {
            const loading = document.getElementById('loadingSection');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
                hideProgress();
            }
        }

        function showProgress(percent) {
            const container = document.getElementById('progressContainer');
            const bar = document.getElementById('progressBar');
            
            container.classList.add('show');
            bar.style.width = percent + '%';
        }

        function hideProgress() {
            const container = document.getElementById('progressContainer');
            container.classList.remove('show');
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('resultMessage');
            resultDiv.textContent = message;
            resultDiv.className = `result-message ${type} show`;
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                resultDiv.classList.remove('show');
            }, 5000);
        }

        // ==================== Image Preview Functions ====================
        function createImagePreviews(files, entryIndex) {
            const fileUpload = document.getElementById(`fileUpload${entryIndex}`);
            let previewContainer = fileUpload.querySelector('.file-preview-container');
            
            // ‡∏•‡∏ö preview container ‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if (previewContainer) {
                previewContainer.remove();
            }
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á preview container ‡πÉ‡∏´‡∏°‡πà
            previewContainer = document.createElement('div');
            previewContainer.className = 'file-preview-container';
            
            const fileArray = Array.from(files);
            fileArray.forEach((file, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'file-preview-item';
                previewItem.setAttribute('data-file-index', index);
                previewItem.setAttribute('data-entry-index', entryIndex);
                
                if (file.type.startsWith('image/')) {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                    const img = document.createElement('img');
                    img.className = 'file-preview-image';
                    img.alt = file.name;
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        img.src = e.target.result;
                        img.setAttribute('data-full-src', e.target.result);
                        img.setAttribute('data-file-name', file.name);
                        img.setAttribute('data-file-size', file.size);
                        img.setAttribute('data-file-type', file.type);
                    };
                    reader.readAsDataURL(file);
                    
                    previewItem.appendChild(img);
                } else if (file.type === 'application/pdf') {
                    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PDF
                    const pdfDiv = document.createElement('div');
                    pdfDiv.className = 'file-preview-pdf';
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        pdfDiv.setAttribute('data-pdf-src', e.target.result);
                        pdfDiv.setAttribute('data-file-name', file.name);
                        pdfDiv.setAttribute('data-file-size', file.size);
                        pdfDiv.setAttribute('data-file-type', file.type);
                    };
                    reader.readAsDataURL(file);
                    
                    pdfDiv.innerHTML = `
                        <div class="file-preview-pdf-icon">üìÑ</div>
                        <div>PDF</div>
                    `;
                    
                    previewItem.appendChild(pdfDiv);
                }
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏° overlay ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå
                const overlay = document.createElement('div');
                overlay.className = 'file-preview-overlay';
                overlay.textContent = file.name.length > 35 ? 
                    file.name.substring(0, 35) + '...' : file.name;
                previewItem.appendChild(overlay);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏° click event ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î modal
                previewItem.addEventListener('click', function() {
                    openImageModal(this);
                });
                
                previewContainer.appendChild(previewItem);
            });
            
            fileUpload.appendChild(previewContainer);
        }
        
        function openImageModal(previewItem) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalPdf = document.getElementById('modalPdf');
            const modalInfo = document.getElementById('modalInfo');
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô
            modalImage.style.display = 'none';
            modalPdf.style.display = 'none';
            
            const img = previewItem.querySelector('.file-preview-image');
            const pdf = previewItem.querySelector('.file-preview-pdf');
            
            if (img) {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                modalImage.src = img.getAttribute('data-full-src');
                modalImage.style.display = 'block';
                
                const fileName = img.getAttribute('data-file-name');
                const fileSize = img.getAttribute('data-file-size');
                const fileType = img.getAttribute('data-file-type');
                
                modalInfo.innerHTML = `
                    <strong>${fileName}</strong><br>
                    ‡∏Ç‡∏ô‡∏≤‡∏î: ${(fileSize / 1024 / 1024).toFixed(2)} MB | 
                    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${fileType}
                `;
            } else if (pdf) {
                // ‡πÅ‡∏™‡∏î‡∏á PDF
                modalPdf.src = pdf.getAttribute('data-pdf-src');
                modalPdf.style.display = 'block';
                
                const fileName = pdf.getAttribute('data-file-name');
                const fileSize = pdf.getAttribute('data-file-size');
                const fileType = pdf.getAttribute('data-file-type');
                
                modalInfo.innerHTML = `
                    <strong>${fileName}</strong><br>
                    ‡∏Ç‡∏ô‡∏≤‡∏î: ${(fileSize / 1024 / 1024).toFixed(2)} MB | 
                    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${fileType}
                `;
            }
            
            modal.classList.add('show');
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î modal
            modal.onclick = function(e) {
                if (e.target === modal) {
                    closeImageModal();
                }
            };
        }
        
        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
            
            // ‡∏•‡πâ‡∏≤‡∏á src ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
            const modalImage = document.getElementById('modalImage');
            const modalPdf = document.getElementById('modalPdf');
            modalImage.src = '';
            modalPdf.src = '';
            
            // ‡∏•‡∏ö event listener
            modal.onclick = null;
        }

        // ==================== Keyboard Shortcuts ====================
        document.addEventListener('keydown', function(e) {
            // Escape ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î modal
            if (e.key === 'Escape') {
                // ‡∏õ‡∏¥‡∏î image modal ‡∏Å‡πà‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà)
                const imageModal = document.getElementById('imageModal');
                if (imageModal.classList.contains('show')) {
                    closeImageModal();
                } else {
                    closeModal();
                }
            }
            
            // Ctrl+Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô upload tab)
            if (e.ctrlKey && e.key === 'Enter') {
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab && activeTab.id === 'upload-tab') {
                    document.getElementById('paymentForm').dispatchEvent(new Event('submit'));
                }
            }
        });

        // ==================== Click Outside Modal ====================
        document.getElementById('nameModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>